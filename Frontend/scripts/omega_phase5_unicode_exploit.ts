
// scripts/omega_phase5_unicode_exploit.ts
import { evaluatePassword, PASS_CONSTANTS } from '../src/logic/passwordSecurity';

const ZERO_WIDTH = '\u200b';
const INVISIBLE_PAYLOAD = 'Pass' + ZERO_WIDTH.repeat(4); // "Pass" + 4 invisible chars = Length 8

function run() {
    console.log('>>> OMEGA PHASE 5: SECURITY ABSOLUTISM (UNICODE)');
    console.log(`Testing Payload: "Pass" + 4x ZeroWidthSpaces`);
    console.log(`Visual Length: 4`);
    console.log(`Technical Length: ${INVISIBLE_PAYLOAD.length}`);

    const result = evaluatePassword(INVISIBLE_PAYLOAD);

    // Phase 0.1 Failure Condition:
    // If the system treats this as meeting the "Length" requirement, it fails.
    // Even if score is low, the length check (line 34 in passwordSecurity.ts) 
    // checks `password.length < MIN`.
    // If 8 < 8 is false, it proceeds to zxcvbn.
    // We want it to be REJECTED as "Too Short" explicitly because invisible chars don't count.

    if (INVISIBLE_PAYLOAD.length >= PASS_CONSTANTS.MIN_LENGTH) {
        console.log('VIOLATION: Zero-width characters counted towards length!');
        console.log(`System sees length ${INVISIBLE_PAYLOAD.length}, User sees 4.`);

        // Check if we get the "Too short" warning
        // If we DON'T get "Too short", we have failed the Anti-Obfuscation check.
        if (result.feedback.warning !== 'Too short') {
            console.log('FAIL: System did not warn about shortness.');
            process.exit(1);
        } else {
            console.log('PASS: System somehow knew it was short? (Unlikely unless Zxcvbn ignores them?)');
        }
    } else {
        console.log('PASS: Length check correctly excluded invisible chars? (Unlikely for standard .length)');
    }
}

run();
